<!-- Victor Zhang, created August 14, 2018 -->
<!-- Website to monitor all data recorded -->
<!-- version 0.2.1-->
<!-- HTML&CSS -->

<!DOCTYPE html>
<html>
<head>
<meta http-equiv="refresh" content="5">
  <style>
   /* * {
    margin: 0.5%;
    padding: 0;
    background-color: yellow;
  }*/
  .titleDiv{
    width: 100%;
    height: 1%;
    overflow: auto;
    background-color: red;
    text-align: center;
    display: block;
  }
  .imgbox {
    display: grid;
    width:100%
    height: auto;
    border: 2px solid black;
  }
  .center-fit {
    max-width: 100%;
    max-height: 100vh;
    margin: auto;
  }
  .dataDivB{
    vertical-align: top;
    width = 100%;
    height = 1%;
    overflow: auto;
    background-color: aqua;
  }
  .Row{
    display:table;
    width: 100%;
    table-layout: fixed;
  }
  .Column{
    display:table-cell;
    background-color: aqua;
    border-spacing: 20px;
    border:1px black solid;
    height = 1%;
    overflow: auto;
  }
  .dataDivY{
    vertical-align: top;
    width = 100%;
    height = 1%;
    overflow: auto;
    background-color: yellow;
  }
  .dataDivBor{
    vertical-align: top;
    width = 100%;
    height = 1%;
    overflow: auto;
    display: inline-block;
    border: 2px solid black;
  }
  </style>

    <title>Data Acquisition Page </title>

<script>
// Javascript environment

// Global variables
var chlTemp_Low = [], // first element is lower temp. limit of chl 1, etc.
    chlTemp_Up = []; // first element is upper temp. limit of chl 1, etc.

var coolWaterFR, coolWaterFR_Low, coolWaterFR_Up,
    tempHeComp, tempHeComp_Low, tempHeComp_Up,
    tempLab, tempLab_Low, tempLab_Up,
    humdLab, humdLab_Low, humdLab_Up,
    nitroTrapWght, nitroTrapWght_Low, nitroTrapWght_Up;

window.onload=function(){ 
    with (new XMLHttpRequest()) {
        onreadystatechange = environmentParams; 
        open('GET','cryo-Environment-Data.dat',true); 
        responseType='text';
        send();
    }
    with (new XMLHttpRequest()) {
        onreadystatechange = tempTableWriter; 
        open('GET','cryo-LS372-Temp.dat',true); 
        responseType='text';
        send();
    }
}

function tempTableWriter(){
    if(this.readyState===4){
        if(this.status === 200 || this.status === 0){
            document.getElementById('main').innerHTML = getTableText(this.responseText); 
        }
    }
}

function getTableText(csv){

    dat = csv.split('\n');
    printDat = "<tr><th>Time and Date</th><th>Channel 1</th><th>Channel 2</th><th>Channel 3</th><th>Channel 4</th><th>Channel 5</th><th>Channel 6</th><th>Channel 7</th><th>Channel 8</th></tr><tr><th></th><th>PT2 Head</th><th>PT2 Plate</th><th>1 K Plate</th><th>Still</th><th>mK Plate Cernox</th><th>PT1 Head</th><th>PT1 Plate</th><th>mK Plate RuOx</th></tr>";
    tempRow = "";

    // to start printing from the most recent data point (last row in the cryo-LS372-Temp.dat list), in the for loop below, i must start from dat.length-2, since dat.length-1 is an empty row (in realTime_my_socket.py, I add "\n" at the end of writing each row, and in dat = csv.split('\n') above, the separator is '\n', so the last element of dat (dat is an array, where each element is an entire row of cryo-LS372-Temp.dat) is empty
    for (i=dat.length-2; i>=dat.length-5; i--){ 
        tempRow = dat[i].split(',');
        printDat+='<tr><td style = "text-align:center">' + tempRow[0] + '</td>';
        for (j = 1; j < 9; j++){
            if (parseFloat(tempRow[j]) >= chlTemp_Low[j-1] && parseFloat(tempRow[j])<=chlTemp_Up[j-1]){
                printDat += '<td style = "text-align:center;color:green">' + tempRow[j] + '</td>';
            }
            else{
                printDat += '<td style = "text-align:center;color:red">' + tempRow[j] + '</td>';
            }
        }
        printDat += "</tr>";
    }
    return printDat;
}

function environmentParams(){
    if(this.readyState===4){
        if(this.status === 200 || this.status === 0){
            dat = this.responseText.split('\n');
            dat = dat.filter(function(e){return e === 0 || e}); // Note: each line of cryo-Environment-Data.dat is an array element of dat
            
            // In below, isNaN() checks if string is a number; in particular "12" is counted as a number, while "12/2" is not a number
            coolWaterFR = dat[19].substring(dat[19].indexOf("=")+1).replace(/\s/g,"");
            coolWaterFR_Low = dat[20].substring(dat[20].indexOf("=")+1).replace(/\s/g,"");
            coolWaterFR_Up = dat[21].substring(dat[21].indexOf("=")+1).replace(/\s/g,"");
            
            tempHeComp = dat[22].substring(dat[22].indexOf("=")+1).replace(/\s/g,"");      
            tempHeComp_Low = dat[23].substring(dat[23].indexOf("=")+1).replace(/\s/g,"");
            tempHeComp_Up = dat[24].substring(dat[24].indexOf("=")+1).replace(/\s/g,"");

            tempLab = dat[25].substring(dat[25].indexOf("=")+1).replace(/\s/g,"");
            tempLab_Low = dat[26].substring(dat[26].indexOf("=")+1).replace(/\s/g,"");
            tempLab_Up = dat[27].substring(dat[27].indexOf("=")+1).replace(/\s/g,"");

            humLab = dat[28].substring(dat[28].indexOf("=")+1).replace(/\s/g,"");
            humLab_Low = dat[29].substring(dat[29].indexOf("=")+1).replace(/\s/g,"");
            humLab_Up = dat[30].substring(dat[30].indexOf("=")+1).replace(/\s/g,"");

            nitroTrapWght = dat[31].substring(dat[31].indexOf("=")+1).replace(/\s/g,"");
            nitroTrapWght_Low = dat[32].substring(dat[32].indexOf("=")+1).replace(/\s/g,"");
            nitroTrapWght_Up = dat[33].substring(dat[33].indexOf("=")+1).replace(/\s/g,"");
            
            for(i = 0; i < 8; i++){
                chlTemp_Low[i] = dat[3+i*2].substring(dat[3+i*2].indexOf("=")+1).replace(/\s/g,"");
                chlTemp_Up[i] = dat[4+i*2].substring(dat[4+i*2].indexOf("=")+1).replace(/\s/g,"");
            }		

            if (parseFloat(coolWaterFR) >= parseFloat(coolWaterFR_Low) && parseFloat(coolWaterFR) <= parseFloat(coolWaterFR_Up)){
                document.getElementById('coolWaterFREle').innerHTML = '<h3 style = "text-align:center;color:green">' + coolWaterFR + '</h3>';
            }
            else{
                document.getElementById('coolWaterFREle').innerHTML = '<h3 style = "text-align:center;color:red">' + coolWaterFR + '</h3>';
            }

            if (parseFloat(tempHeComp) >= parseFloat(tempHeComp_Low) && parseFloat(tempHeComp) <= parseFloat(tempHeComp_Up)){
                document.getElementById('heCompTempEle').innerHTML = '<h3 style = "text-align:center;color:green">' + tempHeComp + '</h3>';
            }
            else{
                document.getElementById('heCompTempEle').innerHTML = '<h3 style = "text-align:center;color:red">' + tempHeComp + '</h3>';
            }

            var tempHumLine = '<h3 style = "text-align:center">';
            if (parseFloat(tempLab) >= parseFloat(tempLab_Low) && parseFloat(tempLab) <= parseFloat(tempLab_Up)){
                tempHumLine += '<span style = "color:green">' + tempLab + '</span>, ';
            }
            else{
                tempHumLine += '<span style = "color:red">' + tempLab + '</span>, ';
            }
            if (parseFloat(humLab) >= parseFloat(humLab_Low) && parseFloat(humLab) <= parseFloat(humLab_Up)){
                tempHumLine += '<span style = "color:green">' + humLab + '</span>';
            }
            else{
                tempHumLine += '<span style = "color:red">' + humLab + '</span>';
            }

            tempHumLine += "</h3>";
            document.getElementById('tempHumLabEle').innerHTML = tempHumLine; 

            if (parseFloat(nitroTrapWght) >= parseFloat(nitroTrapWght_Low) && parseFloat(nitroTrapWght) <= parseFloat(nitroTrapWght_Up)){
                document.getElementById('nitroTrapEle').innerHTML = '<h3 style = "text-align:center;color:green">' + nitroTrapWght + '</h3>';
            }
            else{
                document.getElementById('nitroTrapEle').innerHTML = '<h3 style = "text-align:center;color:red">' + nitroTrapWght + '</h3>';
            }

        }
    }

}


</script>




</head>

<body>
<!--
    <input type="button" id='script' name="scriptbutton" value=" Run Script " onclick="goPython()">

    <script src="http://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>

    <script>
        function goPython(){
            $.ajax({
              url: "realTime_my_socket.py",
             context: document.body
            }).done(function() {
             alert('finished python script');;
            });
        }
    </script>-->


  <div class = "titleDiv">
    <h1>Test Data Acquisition Page</h1>
  </div>

 <div class = "Row">
    <div class = "Column"> 
        <h2 style="text-align:center;">Cooling Water Flow Rate (L/min)</h2>
        <p id = "coolWaterFREle"><p>
    </div>
    <div class = "Column"> 
        <h2 style="text-align:center;">Temp. of He Compressor (K)</h2>
        <p id = "heCompTempEle"><p>
    </div>
    <div class = "Column"> 
        <h2 style="text-align:center;">Temp. (K), Hum. (%) of Lab</h2>
        <p id = "tempHumLabEle"><p>
    </div>
    <div class = "Column"> 
        <h2 style="text-align:center;">Weight (kg) of N2 Trap</h2>
        <p id = "nitroTrapEle"><p>
    </div>
  </div>

  <div class = "dataDivY">
    <table id = "main" style="width:100%;text-align:center;background-color:yellow;"></table>
  </div>

  <div class = "imgbox">
   <img class = "center-fit" src='realTimeTempGraph2.png' />
  </div>
  <div class = "imgbox">
   <img class = "center-fit" src="http://goo.gl/ijai22" />
  </div>
  <div class = "imgbox">
   <img class = "center-fit" src="http://goo.gl/ijai22" />
  </div>
  <a href = "www.google.com">This is the link to Google's website</a>

  <h2>Possible Location for Temperature of Cryostat?</h2>
  <h2>Temperature of Channel 1</h2>
  <h3>temp: 100K</h3>
  <h2>Temp Chl 2 </h2>


  <p><font color = "red">asdlfkn fd aklfld askfdsl slfkl lakfslk skl kalk  klkcmlcicnckd a; 'ds lasf dlld'</font></p>
  <b>Bold text</b>
  <i>Italic text</i>
  <u>Underlined text</u>
  <sub>Subscript text</sub>
  <sup>Superscript text</sup>

</body>
</html>
